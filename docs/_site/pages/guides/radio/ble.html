<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>0x03 - Analyzing BLE - NSE Lab</title> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>0x03 - Analyzing BLE | NSE Lab</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="0x03 - Analyzing BLE" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Documentation for the Division of Network and Systems Engineering’s Cyber Security Lab at KTH" /> <meta property="og:description" content="Documentation for the Division of Network and Systems Engineering’s Cyber Security Lab at KTH" /> <link rel="canonical" href="http://localhost:4000/pages/guides/radio/ble.html" /> <meta property="og:url" content="http://localhost:4000/pages/guides/radio/ble.html" /> <meta property="og:site_name" content="NSE Lab" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="0x03 - Analyzing BLE" /> <script type="application/ld+json"> {"url":"http://localhost:4000/pages/guides/radio/ble.html","@type":"WebPage","headline":"0x03 - Analyzing BLE","description":"Documentation for the Division of Network and Systems Engineering’s Cyber Security Lab at KTH","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="http://localhost:4000/" class="site-title lh-tight"> NSE Lab </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/pages/guides/hacking_guides.html" class="nav-list-link">Hacking Guides</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/pages/guides/pentest-process-planning.html" class="nav-list-link">Planning</a></li><li class="nav-list-item "><a href="http://localhost:4000/pages/guides/pentest-process-exploit.html" class="nav-list-link">Exploitation</a></li><li class="nav-list-item "><a href="http://localhost:4000/pages/guides/pentest-process-report.html" class="nav-list-link">Reporting</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/pages/guides/Wireless/wireless.html" class="nav-list-link">Wireless Hacking</a><ul class="nav-list"><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/Wireless/wireshark.html" class="nav-list-link">Wireshark</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/Wireless/wifi-mitm.html" class="nav-list-link">Wi-Fi MITM</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/Wireless/bluetooth.html" class="nav-list-link">Bluetooth</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/Wireless/lte-hacking.html" class="nav-list-link">Overview of LTE Hacking</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/Wireless/soho-device_exploitation.html" class="nav-list-link">SOHO Device Exploitation</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/Wireless/ubertooth.html" class="nav-list-link">Ubertooth One</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/Wireless/arp-spoofing.html" class="nav-list-link">ARP Spoofing and MitM attacks</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/pages/guides/hardware/hardware.html" class="nav-list-link">Hardware Hacking</a><ul class="nav-list"><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/hardware/uart.html" class="nav-list-link">0x01 - Analyzing UART</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/hardware/i2c.html" class="nav-list-link">0x02 - Analyzing I2C</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/hardware/spi.html" class="nav-list-link">0x03 - Analyzing SPI</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/hardware/jtag.html" class="nav-list-link">0x04 - Analyzing JTAG</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/hardware/emmc.html" class="nav-list-link">0x05 - Analyzing eMMC</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/hardware/hardware_hacking.html" class="nav-list-link">0x06 - Useful links and tutorials</a> </li></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/pages/guides/radio/radio.html" class="nav-list-link">Radio Hacking</a><ul class="nav-list"><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/radio/sdr.html" class="nav-list-link">0x01 - Analyzing SDR</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/radio/zigbee.html" class="nav-list-link">0x02 - Analyzing ZigBee</a> </li><li class="nav-list-item active"> <a href="http://localhost:4000/pages/guides/radio/ble.html" class="nav-list-link active">0x03 - Analyzing BLE</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/radio/hackrf.html" class="nav-list-link">HackRF One</a> </li></ul></li><li class="nav-list-item "><a href="http://localhost:4000/pages/guides/firmware/firmware_hacking.html" class="nav-list-link">Firmware Hacking</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/pages/guides/fuzzing/fuzzing.html" class="nav-list-link">Fuzzing</a><ul class="nav-list"><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/fuzzing/introduction.html" class="nav-list-link">Introduction to Clusterfuzz</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/fuzzing/configuring-clusterfuzz.html" class="nav-list-link">Configuring the lab's Clusterfuzz service</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/fuzzing/start-stop.html" class="nav-list-link">Start/stop the Service</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/pages/guides/web/web.html" class="nav-list-link">Web Hacking</a><ul class="nav-list"><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/web/injection.html" class="nav-list-link">0x01 - Injection Attacks</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/web/authentication.html" class="nav-list-link">0x02 - Broken Authentication</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/web/sensitive-exposure.html" class="nav-list-link">0x03 - Sensitive Data Exposure</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/web/xxe.html" class="nav-list-link">0x04 - XML External Entities (XXE)</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/web/access-control.html" class="nav-list-link">0x05 - Broken Access Control</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/web/security-misconfiguration.html" class="nav-list-link">0x06 - Security Misconfiguration</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/web/xss.html" class="nav-list-link">0x07 - Cross Site Scripting (XSS)</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/web/insecure-deserialization.html" class="nav-list-link">0x08 - Insecure Deserialization</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/web/components.html" class="nav-list-link">0x09 - Using Components with Known Vulnerabilities</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/web/logging-and-monitoring.html" class="nav-list-link">0x10 - Insufficient Logging and Monitoring</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/web/http-request-smuggling.html" class="nav-list-link">0x11 - HTTP Request Smuggling</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/pages/guides/Creating%20threat%20models/Creating%20Threat%20Models.html" class="nav-list-link">Creating Threat Models</a><ul class="nav-list"><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/Creating%20threat%20models/Prerequisites.html" class="nav-list-link">Prerequisites</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/Creating%20threat%20models/MAL.html" class="nav-list-link">MAL</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/Creating%20threat%20models/securiCAD.html" class="nav-list-link">securiCAD</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/Creating%20threat%20models/DSL.html" class="nav-list-link">DSL</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/Creating%20threat%20models/coreLang.html" class="nav-list-link">coreLang</a> </li></ul></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/pages/thesis_guidelines/guidelines.html" class="nav-list-link">Thesis Guidelines</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/pages/thesis_guidelines/registration.html" class="nav-list-link">Registration</a></li><li class="nav-list-item "><a href="http://localhost:4000/pages/thesis_guidelines/objective.html" class="nav-list-link">Objective</a></li><li class="nav-list-item "><a href="http://localhost:4000/pages/thesis_guidelines/choice_of_system.html" class="nav-list-link">Choice of System to Explore</a></li><li class="nav-list-item "><a href="http://localhost:4000/pages/thesis_guidelines/things_to_hack.html" class="nav-list-link">Things to hack</a></li><li class="nav-list-item "><a href="http://localhost:4000/pages/thesis_guidelines/purchase_form.html" class="nav-list-link">Purchase Form</a></li><li class="nav-list-item "><a href="http://localhost:4000/pages/thesis_guidelines/delimitations.html" class="nav-list-link">Delimitations</a></li><li class="nav-list-item "><a href="http://localhost:4000/pages/thesis_guidelines/method.html" class="nav-list-link">Method</a></li><li class="nav-list-item "><a href="http://localhost:4000/pages/thesis_guidelines/theory.html" class="nav-list-link">Theory</a></li><li class="nav-list-item "><a href="http://localhost:4000/pages/thesis_guidelines/related_work.html" class="nav-list-link">Related work</a></li><li class="nav-list-item "><a href="http://localhost:4000/pages/thesis_guidelines/thesis_report.html" class="nav-list-link">Thesis Report</a></li><li class="nav-list-item "><a href="http://localhost:4000/pages/thesis_guidelines/threat_traceability_matrix.html" class="nav-list-link">Threat Traceability Matrix</a></li><li class="nav-list-item "><a href="http://localhost:4000/pages/thesis_guidelines/grading_criteria.html" class="nav-list-link">Grading criteria</a></li><li class="nav-list-item "><a href="http://localhost:4000/pages/thesis_guidelines/language.html" class="nav-list-link">Language</a></li><li class="nav-list-item "><a href="http://localhost:4000/pages/thesis_guidelines/tutoring.html" class="nav-list-link">Tutoring</a></li><li class="nav-list-item "><a href="http://localhost:4000/pages/thesis_guidelines/responsible_disclosure.html" class="nav-list-link">Responsible disclosure</a></li><li class="nav-list-item "><a href="http://localhost:4000/pages/thesis_guidelines/the_law.html" class="nav-list-link">The Law</a></li><li class="nav-list-item "><a href="http://localhost:4000/pages/thesis_guidelines/lab.html" class="nav-list-link">Cyber Security Lab</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/pages/lab-equipment/lab-equipment.html" class="nav-list-link">Lab Equipment</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/pages/lab-equipment/iot-devices.html" class="nav-list-link">IoT Devices</a></li><li class="nav-list-item "><a href="http://localhost:4000/pages/lab-equipment/hacking-tools.html" class="nav-list-link">Hacking Tools</a></li><li class="nav-list-item "><a href="http://localhost:4000/pages/lab-equipment/computers.html" class="nav-list-link">Computers and hardware</a></li><li class="nav-list-item "><a href="http://localhost:4000/pages/lab-equipment/books.html" class="nav-list-link">Books</a></li><li class="nav-list-item "><a href="http://localhost:4000/pages/lab-equipment/lab-servers.html" class="nav-list-link">Lab Servers</a></li><li class="nav-list-item "><a href="http://localhost:4000/pages/lab-equipment/vpn.html" class="nav-list-link">VPN</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/pages/previous-work/previous-work.html" class="nav-list-link">Previous Work</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/pages/previous-work/theses.html" class="nav-list-link">Published Theses</a></li><li class="nav-list-item "><a href="http://localhost:4000/pages/previous-work/media-coverage.html" class="nav-list-link">Media Coverage</a></li><li class="nav-list-item "><a href="http://localhost:4000/pages/previous-work/vulns.html" class="nav-list-link">Vulnerabilities Found</a></li><li class="nav-list-item "><a href="http://localhost:4000/pages/previous-work/social-media.html" class="nav-list-link">Social Media</a></li></ul></li><li class="nav-list-item"><a href="http://localhost:4000/pages/contribute.html" class="nav-list-link">Contribute</a></li><li class="nav-list-item"><a href="http://localhost:4000/pages/feedback.html" class="nav-list-link">Feedback</a></li><li class="nav-list-item"><a href="http://localhost:4000/pages/gallery.html" class="nav-list-link">Gallery</a></li><li class="nav-list-item"><a href="http://localhost:4000/" class="nav-list-link">Home</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search NSE Lab" aria-label="Search NSE Lab" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/pages/guides/hacking_guides.html">Hacking Guides</a></li> <li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/pages/guides/radio/radio.html">Radio Hacking</a></li> <li class="breadcrumb-nav-list-item"><span>0x03 - Analyzing BLE</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 id="analyzing-ble"> <a href="#analyzing-ble" class="anchor-heading" aria-labelledby="analyzing-ble"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Analyzing BLE </h1> <h2 id="1-bluetooth-low-energy-ble-internals"> <a href="#1-bluetooth-low-energy-ble-internals" class="anchor-heading" aria-labelledby="1-bluetooth-low-energy-ble-internals"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1. Bluetooth Low Energy (BLE) internals </h2> <h3 id="introduction-and-terminology"> <a href="#introduction-and-terminology" class="anchor-heading" aria-labelledby="introduction-and-terminology"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Introduction and Terminology </h3> <p>The way BLE devices discover and connect to each other is determined through the <b>Generic Access Profile</b>, or <b>GAP</b> for short.</p> <p><b>The Generic Attribute Profile</b>, or <b>GATT</b>, determines how two devices transfer data back and forth, once the devices have discovered and connected to each other using GAP. GATT uses the <b>Attribute Protocol</b>, or <b>ATT</b>, to store <em>Services</em> and <em>Characteristics</em> in a simple lookup table. Services divide data into logical chunks, and each Service has a UUID. Services consist of Characteristics, which are the data points themselves. Like Services, each Characteristic has a UUID.</p> <p>Note that BLE peripherals can only be connected to one central device at any given time. The central device however, can be connected to several peripheral devices at once.</p> <h4 id="example"> <a href="#example" class="anchor-heading" aria-labelledby="example"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Example </h4> <p>A profile has Service A (for example heart rate in UUID format) and Service B (for example blood pressure in UUID format).</p> <p>Service A and Service B consist of characteristics, which in turn consist of values and descriptors.</p> <p>Other profiles are structured similarly.</p> <p><img src="/pages/guides/images/profiles-services-characteristics.png" alt="alt text" /> [2]</p> <h3 id="service"> <a href="#service" class="anchor-heading" aria-labelledby="service"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Service </h3> <p>Structure:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>attr handle	| (first handle id for the service)
end grp handle	| (last handle id for the service)
uuid 		| (first 8-digit from left hand side specifies service name)
</code></pre></div></div> <p>All the currently registered UUIDs by Bluetooth and their corresponding service names can be found in the <a href="https://www.bluetooth.com/specifications/gatt/services">Bluetooth SIG documentation</a>. Custom services are not defined there, however.</p> <ul> <li>Characteristics <ul> <li>Structure <ul> <li>handle</li> <li>char properties</li> <li>char value handle</li> <li>uuid</li> </ul> </li> <li>Value: Descriptor is a hex encoded ASCII data</li> </ul> </li> <li>BLE authentication (association process) <ul> <li>Broadcaster device <ul> <li>broadcast to announce availability</li> <li>collect and monitor data</li> </ul> </li> <li>Observer device <ul> <li>observe broadcasts</li> <li>if it is an interested broadcast, send a connection request to the peripheral</li> </ul> </li> <li>Peripheral device <ul> <li>if peripheral accepts the request, observer and peripheral are connected</li> <li>based on the pairing mechanism</li> <li>data transmission starts each other</li> </ul> </li> </ul> </li> <li>Pairing mechanisms (Pairing encryption) <ul> <li>JustWorks (JW) <ul> <li>without display or small display without keyboard</li> <li>key is 000000</li> </ul> </li> <li>Numeric comparison <ul> <li>shows the same number on both devices</li> <li>asks for yes or no</li> </ul> </li> <li>Passkey <ul> <li>6-digit passcode</li> <li>(easy to brute force)</li> </ul> </li> <li>Out of band <ul> <li>shares the pin using an out of band channel like NFC</li> </ul> </li> </ul> </li> </ul> <h2 id="2-ble-pentest-objectives"> <a href="#2-ble-pentest-objectives" class="anchor-heading" aria-labelledby="2-ble-pentest-objectives"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2. BLE pentest objectives </h2> <ul> <li>Sniffing</li> <li>Reading</li> <li>Modifying characteristics (change behavior of the device by remotely controlling)</li> </ul> <h2 id="3-interacting-with-ble-devices"> <a href="#3-interacting-with-ble-devices" class="anchor-heading" aria-labelledby="3-interacting-with-ble-devices"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3. Interacting with BLE devices </h2> <ul> <li>Plug in BLE adapter dongle on analysis computer</li> <li> <p>Get Blootooth Address (BD_ADDR)</p> <p><code class="language-plaintext highlighter-rouge">hciconfig</code></p> </li> <li> <p>Search for BLE devices around (via hcitool or Blue Hydra)</p> <p><code class="language-plaintext highlighter-rouge">hcitool lescan</code></p> </li> <li> <p>Connect to target beacon (via Gatttool utility)</p> <p><code class="language-plaintext highlighter-rouge">gatttool -I -b &lt;beacon address&gt;</code></p> </li> <li> <p>List the BLE services</p> <p><code class="language-plaintext highlighter-rouge">primary</code></p> </li> <li> <p>List the service characteristics</p> <p><code class="language-plaintext highlighter-rouge">characteristics</code></p> </li> <li> <p>Read characteristics value and descriptor</p> <p><code class="language-plaintext highlighter-rouge">char-read-hnd &lt;char value handle&gt;</code></p> </li> <li>Decode hex to ASCII</li> </ul> <h2 id="4-modify-data"> <a href="#4-modify-data" class="anchor-heading" aria-labelledby="4-modify-data"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 4. Modify data </h2> <ul> <li>In order to modify something, functionality of the device is well-understand</li> <li>Then how these functionality is stored on device as values are identified</li> <li>Example I <ul> <li>BLE devices disconnects from mobile application in every X seconds</li> <li>Then re-connects again, this mechanism is known as heart-beat</li> <li>If heartbeat does not happen, a notification appears or sound triggered</li> <li>Attacker may want to modify the connection time to unlimited</li> <li>Therefore mobile app will not identify BLE device is stolen or broken</li> </ul> </li> <li>Example II <ul> <li>mobile app tracks the distance of an object</li> <li>if it goes across the range, mobile app makes a buzzer</li> <li>attacker may want to prevent buzzer not to notice owner</li> </ul> </li> <li> <p>List all handles</p> <p><code class="language-plaintext highlighter-rouge">chr-desc &lt;attr handle&gt; &lt;end group handle&gt;</code></p> </li> <li>Check for Bluetooth SIG documentation (to understand functionality) <ul> <li>identify services defined by manufacturers and by SIG</li> </ul> </li> <li> <p>Read characteristics value and descriptor</p> <p><code class="language-plaintext highlighter-rouge">char-read-hnd &lt;char value handle&gt;</code></p> </li> <li> <p>Update characteristics value and descriptor</p> <p><code class="language-plaintext highlighter-rouge">char-write-hnd &lt;char value handle&gt; &lt;a char value same as to original format&gt;</code></p> </li> </ul> <h2 id="5-sniffing-ble-traffic"> <a href="#5-sniffing-ble-traffic" class="anchor-heading" aria-labelledby="5-sniffing-ble-traffic"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 5. Sniffing BLE traffic </h2> <ul> <li>In order to understand the functionality of services defined by manufacturers <ul> <li>sniff the BLE traffic</li> <li>press any buttons of the device to capture functionality</li> </ul> </li> <li>Ubertooth One <ul> <li>download and install ubertooth utility</li> <li> <p>sniff traffic</p> <p><code class="language-plaintext highlighter-rouge">ubertooth-btle -f -t &lt;target device BD_ADDR&gt;</code></p> </li> <li> <p>sniff traffic and dump into a pcap file</p> <p><code class="language-plaintext highlighter-rouge">ubertooth-btle -f -t &lt;target device BD_ADDR&gt; - c ble-dump.pcap</code></p> </li> <li> <p>Relevant data</p> <div class="table-wrapper"><table> <tbody> <tr> <td>Access address (AA)</td> <td>used to manage link layer</td> </tr> <tr> <td>Channel Index</td> <td>dedicated advertising channel</td> </tr> <tr> <td>Packet PDU Type</td> <td>ADV_IND ADV_DIRECT_IND ADV_NONCONN_IND ADV_SCAN_IND SCAN_REQ SCAN_RSP CONNECT_REQ</td> </tr> <tr> <td>AdvA</td> <td>6-byte advertising address (usually BD_ADDR of the device)</td> </tr> <tr> <td>ScanA</td> <td>6-byte scanner address</td> </tr> </tbody> </table></div> </li> <li> <p>Advertising PDUs</p> <div class="table-wrapper"><table> <tbody> <tr> <td>ADV_IND</td> <td>Connectable Undirected Advertising</td> </tr> <tr> <td>ADV_DIRECT_IND</td> <td>Connectable Directed Advertising</td> </tr> <tr> <td>ADV_NONCONN_IND</td> <td>Non-Connectable Undirected Advertising</td> </tr> <tr> <td>ADV_SCAN_IND</td> <td>Scannable Undirected Advertising</td> </tr> </tbody> </table></div> </li> <li> <p>Scanning PDUs</p> <div class="table-wrapper"><table> <tbody> <tr> <td>SCAN_REQ</td> <td>Scan request from the mobile app</td> </tr> <tr> <td>SCAN_RSP</td> <td>Scan response from the target device</td> </tr> </tbody> </table></div> </li> <li> <p>Initiating PDUs</p> <div class="table-wrapper"><table> <tbody> <tr> <td>CONNECT_REQ</td> <td>Connection request</td> </tr> </tbody> </table></div> </li> <li>Wireshark <ul> <li>set DLT_USER (in Preferences &gt; Protocols) to btle</li> <li> <p>filter only ATT packets</p> <p><code class="language-plaintext highlighter-rouge">btl2cap.cid==0x004</code></p> </li> <li>set DLT_USER (in Preferences &gt; Protocols) to btle</li> <li>filter Write requests <ul> <li>find the data is written to which Handle</li> </ul> </li> <li>examine the interested packet containing write request <ul> <li>BLE Link Layer</li> <li>Bluetooth Attribute Protocol <ul> <li>Understand Value field</li> </ul> </li> </ul> </li> <li>compare Value field of different packets to identify which bits change <ul> <li>the changed field are the user actions</li> </ul> </li> <li>determine your Value</li> </ul> </li> <li>Replay packet <ul> <li>BTLEJuice utility (web GUI) <ul> <li>sniffs/modifies/replays BLE packets</li> </ul> </li> </ul> </li> <li>Write the value to the device <ul> <li>gatttool “char-write-req”</li> </ul> </li> </ul> </li> </ul> <h2 id="sources"> <a href="#sources" class="anchor-heading" aria-labelledby="sources"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Sources </h2> <p>[1] <em>A Developer’s Guide To Bluetooth</em>. Bluetooth Blog. Martin Woolley. 2016-11-10. <a href="https://www.bluetooth.com/blog/a-developers-guide-to-bluetooth/">https://www.bluetooth.com/blog/a-developers-guide-to-bluetooth/</a>. (Fetched 2021-06-24)<br /></p> <p>[2] <em>Introduction to Bluetooth Low Energy</em>. adafruit learn. Kevin Townsend. 2014-03-20. <a href="https://learn.adafruit.com/introduction-to-bluetooth-low-energy">https://learn.adafruit.com/introduction-to-bluetooth-low-energy</a>. (Fetched 2021-06-24)<br /></p> <hr> <footer> <p class="text-small text-grey-dk-100 mb-0">Division of Network and Systems Engineering | KTH</p> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>

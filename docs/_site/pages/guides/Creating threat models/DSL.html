<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>DSL - NSE Lab</title> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>DSL | NSE Lab</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="DSL" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Documentation for the Division of Network and Systems Engineering’s Cyber Security Lab at KTH" /> <meta property="og:description" content="Documentation for the Division of Network and Systems Engineering’s Cyber Security Lab at KTH" /> <link rel="canonical" href="http://localhost:4000/pages/guides/Creating%20threat%20models/DSL.html" /> <meta property="og:url" content="http://localhost:4000/pages/guides/Creating%20threat%20models/DSL.html" /> <meta property="og:site_name" content="NSE Lab" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="DSL" /> <script type="application/ld+json"> {"headline":"DSL","description":"Documentation for the Division of Network and Systems Engineering’s Cyber Security Lab at KTH","@type":"WebPage","url":"http://localhost:4000/pages/guides/Creating%20threat%20models/DSL.html","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="http://localhost:4000/" class="site-title lh-tight"> NSE Lab </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/pages/thesis_guidelines/guidelines.html" class="nav-list-link">Thesis Guidelines</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/pages/thesis_guidelines/registration.html" class="nav-list-link">Registration</a></li><li class="nav-list-item "><a href="http://localhost:4000/pages/thesis_guidelines/objective.html" class="nav-list-link">Objective</a></li><li class="nav-list-item "><a href="http://localhost:4000/pages/thesis_guidelines/choice_of_system.html" class="nav-list-link">Choice of System to Explore</a></li><li class="nav-list-item "><a href="http://localhost:4000/pages/thesis_guidelines/things_to_hack.html" class="nav-list-link">Things to hack</a></li><li class="nav-list-item "><a href="http://localhost:4000/pages/thesis_guidelines/purchase_form.html" class="nav-list-link">Purchase Form</a></li><li class="nav-list-item "><a href="http://localhost:4000/pages/thesis_guidelines/delimitations.html" class="nav-list-link">Delimitations</a></li><li class="nav-list-item "><a href="http://localhost:4000/pages/thesis_guidelines/theory.html" class="nav-list-link">Theory</a></li><li class="nav-list-item "><a href="http://localhost:4000/pages/thesis_guidelines/method.html" class="nav-list-link">Method</a></li><li class="nav-list-item "><a href="http://localhost:4000/pages/thesis_guidelines/related_work.html" class="nav-list-link">Related work</a></li><li class="nav-list-item "><a href="http://localhost:4000/pages/thesis_guidelines/thesis_report.html" class="nav-list-link">Thesis Report</a></li><li class="nav-list-item "><a href="http://localhost:4000/pages/thesis_guidelines/threat_traceability_matrix.html" class="nav-list-link">Threat Traceability Matrix</a></li><li class="nav-list-item "><a href="http://localhost:4000/pages/thesis_guidelines/grading_criteria.html" class="nav-list-link">Grading criteria</a></li><li class="nav-list-item "><a href="http://localhost:4000/pages/thesis_guidelines/language.html" class="nav-list-link">Language</a></li><li class="nav-list-item "><a href="http://localhost:4000/pages/thesis_guidelines/tutoring.html" class="nav-list-link">Tutoring</a></li><li class="nav-list-item "><a href="http://localhost:4000/pages/thesis_guidelines/responsible_disclosure.html" class="nav-list-link">Responsible disclosure</a></li><li class="nav-list-item "><a href="http://localhost:4000/pages/thesis_guidelines/the_law.html" class="nav-list-link">The Law</a></li><li class="nav-list-item "><a href="http://localhost:4000/pages/thesis_guidelines/lab.html" class="nav-list-link">Cyber Security Lab</a></li></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/pages/guides/hacking_guides.html" class="nav-list-link">Hacking Guides</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/pages/guides/pentest-process-planning.html" class="nav-list-link">Planning</a></li><li class="nav-list-item "><a href="http://localhost:4000/pages/guides/pentest-process-exploit.html" class="nav-list-link">Exploitation</a></li><li class="nav-list-item "><a href="http://localhost:4000/pages/guides/pentest-process-report.html" class="nav-list-link">Reporting</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/pages/guides/Wireless/wireless.html" class="nav-list-link">Wireless Hacking</a><ul class="nav-list"><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/Wireless/wireshark.html" class="nav-list-link">Wireshark</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/Wireless/wifi-mitm.html" class="nav-list-link">Wi-Fi MITM</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/Wireless/bluetooth.html" class="nav-list-link">Bluetooth</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/Wireless/lte-hacking.html" class="nav-list-link">Overview of LTE Hacking</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/Wireless/ubertooth.html" class="nav-list-link">Ubertooth One</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/Wireless/soho-device_exploitation.html" class="nav-list-link">SOHO Device Exploitation</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/Wireless/arp-spoofing.html" class="nav-list-link">ARP Spoofing and MitM attacks</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/pages/guides/hardware/hardware.html" class="nav-list-link">Hardware Hacking</a><ul class="nav-list"><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/hardware/uart.html" class="nav-list-link">0x01 - Analyzing UART</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/hardware/i2c.html" class="nav-list-link">0x02 - Analyzing I2C</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/hardware/spi.html" class="nav-list-link">0x03 - Analyzing SPI</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/hardware/jtag.html" class="nav-list-link">0x04 - Analyzing JTAG</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/hardware/emmc.html" class="nav-list-link">0x05 - Analyzing eMMC</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/hardware/hardware_hacking.html" class="nav-list-link">0x06 - Useful links and tutorials</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/pages/guides/radio/radio.html" class="nav-list-link">Radio Hacking</a><ul class="nav-list"><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/radio/sdr.html" class="nav-list-link">0x01 - Analyzing SDR</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/radio/zigbee.html" class="nav-list-link">0x02 - Analyzing ZigBee</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/radio/ble.html" class="nav-list-link">0x03 - Analyzing BLE</a> </li></ul></li><li class="nav-list-item "><a href="http://localhost:4000/pages/guides/firmware/firmware_hacking.html" class="nav-list-link">Firmware Hacking</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/pages/guides/fuzzing/fuzzing.html" class="nav-list-link">Fuzzing</a><ul class="nav-list"><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/fuzzing/introduction.html" class="nav-list-link">Introduction to Clusterfuzz</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/fuzzing/configuring-clusterfuzz.html" class="nav-list-link">Configuring the lab's Clusterfuzz service</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/fuzzing/start-stop.html" class="nav-list-link">Start/stop the Service</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/pages/guides/web/web.html" class="nav-list-link">Web Hacking</a><ul class="nav-list"><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/web/injection.html" class="nav-list-link">0x01 - Injection Attacks</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/web/authentication.html" class="nav-list-link">0x02 - Broken Authentication</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/web/sensitive-exposure.html" class="nav-list-link">0x03 - Sensitive Data Exposure</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/web/xxe.html" class="nav-list-link">0x04 - XML External Entities (XXE)</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/web/access-control.html" class="nav-list-link">0x05 - Broken Access Control</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/web/security-misconfiguration.html" class="nav-list-link">0x06 - Security Misconfiguration</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/web/xss.html" class="nav-list-link">0x07 - Cross Site Scripting (XSS)</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/web/insecure-deserialization.html" class="nav-list-link">0x08 - Insecure Deserialization</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/web/components.html" class="nav-list-link">0x09 - Using Components with Known Vulnerabilities</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/web/logging-and-monitoring.html" class="nav-list-link">0x10 - Insufficient Logging and Monitoring</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/web/http-request-smuggling.html" class="nav-list-link">0x11 - HTTP Request Smuggling</a> </li></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/pages/guides/Creating%20threat%20models/Creating%20Threat%20Models.html" class="nav-list-link">Creating Threat Models</a><ul class="nav-list"><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/Creating%20threat%20models/Prerequisites.html" class="nav-list-link">Prerequisites</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/Creating%20threat%20models/MAL.html" class="nav-list-link">MAL</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/Creating%20threat%20models/securiCAD.html" class="nav-list-link">securiCAD</a> </li><li class="nav-list-item active"> <a href="http://localhost:4000/pages/guides/Creating%20threat%20models/DSL.html" class="nav-list-link active">DSL</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/pages/guides/Creating%20threat%20models/coreLang.html" class="nav-list-link">coreLang</a> </li></ul></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/pages/lab-equipment/lab-equipment.html" class="nav-list-link">Lab Equipment</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/pages/lab-equipment/iot-devices.html" class="nav-list-link">IoT Devices</a></li><li class="nav-list-item "><a href="http://localhost:4000/pages/lab-equipment/hacking-tools.html" class="nav-list-link">Hacking Tools</a></li><li class="nav-list-item "><a href="http://localhost:4000/pages/lab-equipment/computers.html" class="nav-list-link">Computers and hardware</a></li><li class="nav-list-item "><a href="http://localhost:4000/pages/lab-equipment/books.html" class="nav-list-link">Books</a></li></ul></li><li class="nav-list-item"><a href="http://localhost:4000/pages/previous-work.html" class="nav-list-link">Previous Work</a></li><li class="nav-list-item"><a href="http://localhost:4000/pages/contribute.html" class="nav-list-link">Contribute</a></li><li class="nav-list-item"><a href="http://localhost:4000/pages/feedback.html" class="nav-list-link">Feedback</a></li><li class="nav-list-item"><a href="http://localhost:4000/" class="nav-list-link">Home</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search NSE Lab" aria-label="Search NSE Lab" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/pages/guides/hacking_guides.html">Hacking Guides</a></li> <li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/pages/guides/Creating%20threat%20models/Creating%20Threat%20Models.html">Creating Threat Models</a></li> <li class="breadcrumb-nav-list-item"><span>DSL</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 id="step-by-step-guide"> <a href="#step-by-step-guide" class="anchor-heading" aria-labelledby="step-by-step-guide"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step-by-Step Guide </h1> <p>This guide aims to go through the work process with creating and implementing a model. The first part tackles how to create an DSL and the second part how to simulate an attack in securiCAD.</p> <p>It is easiest to learn the syntax by modifying an already existing DSL, e.g exampleLang that can be found <a href="https://github.com/mal-lang/exampleLang">here</a>. When you want to create your own DSL you can use the exampleLang project as a template and follow the instructions at the bottom of the README-file.</p> <h2 id="creating-a-model"> <a href="#creating-a-model" class="anchor-heading" aria-labelledby="creating-a-model"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Creating a model </h2> <p>We will use a pre-existing model for this tutorial. The model is originally from a thesis by Eric Bröndum and Christoffer Torgilsman and can be found <a href="http://kth.diva-portal.org/smash/record.jsf?pid=diva2%3A1450590&amp;dswid=-7754">here</a>.</p> <p>The model contains of six different objects.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1. The human user
2. Trifo Home, an mobile application
3. Router
4. Ironpie m6, a robot vacuum cleaner
5. MQTT Server
6. Trifo BackEnd Server
</code></pre></div></div> <p><img src="/pages/guides/Creating%20threat%20models/Images/ironpiemodel.png" alt="title" /></p> <p>You can make this as complicated and realistic as you like but lets keep it simple. Every object in this model is assumed to “one piece”, therefore we will not seperate software from hardware or different running applications on hardware. Lets divide the objects into two categories “Home” and “Company”. The Home-category will contain all objects that is found in the users home or what the user can interact with directly and the Company-category is what the company provides.</p> <p>To get started go to path-to-project/src/main/mal and create a .mal-file named the same name as you specified in the pom.xml-file at the mal.file row.</p> <p>For this guide sake we will name it main.mal. You can have several .mal-files if you want to divide the code up and import them. Here we will just stick to one file and two categories.</p> <p>Start with defining the categories</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>category Home{
}

category Company{
}
</code></pre></div></div> <p>Inside these categories we can define the assets. There are six different assets, or objects, in the model.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>category Home{
  
  asset Human{
  }

  asset TrifoHome{
  }

  asset Router{
  } 

  asset IronpieM6{
  }
}

category Company{

  asset MQTTServer{
  }

  asset BackEndServer{
  }
}
</code></pre></div></div> <p>Same principle as always when you code: Compile often to find errors. If you want to remove the old version and compile a new run the command in the projects main folder</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn clean install
</code></pre></div></div> <p>If we were to visualize the code right now it would look like this.</p> <p><img src="/pages/guides/Creating%20threat%20models/Images/malviz1.png" alt="title" /></p> <p>This image was generated by MAL-visualization. You can find the githubpage and how to install it <a href="https://github.com/mal-lang/MAL-visualization">here</a>.</p> <p>Now all the assets are in place but there are no connections between these. In the model there are connections using both TCP &amp; TCP w/ssl and HTTPS between many of the assets. Before we can model these connections we first need to assiociate the assets with eachother.</p> <p>We will start with associating the human-object to TrifoHome. We assume that there could be more than one human in the household. They can also share a smartphone, therefore many different humans can connect to the same TrifoHome-app if they want. They can also connect to different apps if they own more than one smartphone.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>associations{
  Human [human] * &lt;- UserInteraction -&gt; * [trifo] TrifoHome
}
</code></pre></div></div> <p>Lets go through what just happened. Human stands for the asset Human, and TrifoHome stands for the asset TrifoHome. These two can now connect with each other calling human and trifo. * stands for that infinite many humans can connect to infinite many trifos. And we name this association to “UserInteraction”. Lets say that TrifoHome has a function named “access”, then we can call it from the Human asset using</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>trifo.access
</code></pre></div></div> <p>We add associations for all assets and put them at the bottom of our main.mal-file.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>category Home{
  
  asset Human{
  }

  asset TrifoHome{
  }

  asset Router{
  } 

  asset IronpieM6{
  }
}

category Company{

  asset MQTTServer{
  }

  asset BackEndServer{
  }
}

associations{
  Human [human] * &lt;-- UserInteraction --&gt; * [trifo] TrifoHome
  TrifoHome [trifo] * &lt;-- AppConnection --&gt; 1 [router] Router
  IronpieM6 [iron] * &lt;-- VacuumConnection --&gt; 1 [router] Router 
  MQTTServer [server] * &lt;-- ServerConnection --&gt; 1 [router] Router
  BackEndServer [backend] 1 &lt;-- BackEndConnection --&gt; 1 [server] MQTTServer
}
</code></pre></div></div> <p>You can see that here we also have a 1 in the associations. That means that we can only connect 1 of that asset to another asset. For example, the vacuum cleaner IronpieM6 can only connect to one router, but a router can connect to infintely many vacuum cleaners. In reality we wouldn’t be able to connect infinitely many vacuum cleaners to the same router but we assume that the users of the model will not try to do that.</p> <p>If we visualize the model again we will see: <img src="/pages/guides/Creating%20threat%20models/Images/malviz2.png" alt="title" /></p> <p>The assets are now associated with eachother. This means that we can start calling for assets inside other assets.</p> <p>It is time to start making the connections from the model. As stated earlier, these connections can be as complicated as you like with many connections within the asset itself. For example, a guessed password-function might lead to an access-function and the access-function within the asset, which connects to another asset and so on.</p> <p>Lets connect TrifoHome with the router. We will name two different functions, one for HTTPS and one for TCP. The code inside these two assets will look like this</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  asset TrifoHome {
      | HTTPSconnect

      | HTTPSaccess
        -&gt; router.HTTPSconnect

      | TCPconnect
      
      | TCPaccess
        -&gt; router.TCPconnect
    }

  asset Router {
      | HTTPSconnect

      | HTTPSaccess
        -&gt; trifo.HTTPSaccess

      | TCPconnect

      | TCPaccess
        -&gt; trifo.TCPconnect
    }
</code></pre></div></div> <p>The first function in TrifoHome is what happens when someone connects to it through HTTPS. The second function is what will happen when you use HTTPS to access other services. Same principle for TCP. Right now nothing happens when you connect to the Router or TrifoHome. The user can specify the internal structure of the object with adding necessary functions.</p> <p><img src="/pages/guides/Creating%20threat%20models/Images/malviz3.png" alt="title" /></p> <p>We add the same functions for IronpieM6. We also add a function for ssh login. For simplicity we imagine that connecting to the IronpieM6 gives us direct access to both the TCP connection and HTTPS connection.</p> <p>We will simulate a brute force attack on the ssh. When an attacker is added, it is assumed that they already got a foothold on that function. Therefore we need to circumvent it. This can be done by dividing the attack into two steps.</p> <p>First we add a function for guessing the password</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  asset IronpieM6 {
      | HTTPSconnect

      | HTTPSaccess
        -&gt; router.HTTPSconnect

      | TCPconnect
      
      | TCPaccess
        -&gt; router.TCPconnect
      
      | ssh
        -&gt; HTTPSaccess,
        TCPaccess
      
      | guessPassword

    }
</code></pre></div></div> <p>The guessPassword function call another function that we will call passwordSuccess, but here we will add a probability distribution for success. This will act as a hurdle, since the person trying to brute force the login credentials will not succeed immediately. You can find what different distributions MAL supports <a href="https://github.com/mal-lang/malcompiler/wiki/Supported-distribution-functions">here</a>. There exists some pre-defined distributions, we will use “HardAndUncertain”.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  asset Router {
      | HTTPSconnect

      | HTTPSaccess
        -&gt; trifo.HTTPSaccess

      | TCPconnect

      | TCPaccess
        -&gt; trifo.TCPconnect
      
      | UDPconnect
    }

  asset IronpieM6 {
      | HTTPSconnect

      | HTTPSaccess
        -&gt; router.HTTPSconnect

      | TCPconnect
      
      | TCPaccess
        -&gt; router.TCPconnect
      
      | UDPaccess
        -&gt; router.UDPconnect

      | ssh
        -&gt; HTTPSaccess,
        TCPaccess,
        UDPaccess
      
      | guessPassword
        -&gt; passwordSuccess

      | passwordSuccess [HardAndUncertain]
        -&gt; ssh
    }
</code></pre></div></div> <p><img src="/pages/guides/Creating%20threat%20models/Images/malviz4.png" alt="title" /></p> <p>Lastly we can add the UDP connection between the Router and IronpieM6 and we are done with all the connections for these three assets.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  asset IronpieM6 {
      | HTTPSconnect

      | HTTPSaccess
        -&gt; router.HTTPSconnect

      | TCPconnect
      
      | TCPaccess
        -&gt; router.TCPconnect

      | ssh
        -&gt; HTTPSaccess,
        TCPaccess
      
      | guessPassword
        -&gt; passwordSuccess

      | passwordSuccess [HardAndUncertain]
        -&gt; ssh
    }
</code></pre></div></div> <p>For this tutorial we won’t bother with the connections between Human, MQTTServer and BackEndServer. If would like to add them you can copy-paste from the already completed assets and change the names when you call other assets functions.</p> <p>Compile it and create a .jar-file for securiCAD. For more information how to get securiCAD working visit</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn clean install
mvn package -PsecuriCAD
</code></pre></div></div> <p>Open up securiCAD and when the program asks to you chose a .jar-file go to</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>path-to-project/target
</code></pre></div></div> <p>and chose your *.jar-file and load it up.</p> <p>We can now recreate the model in securiCAD using the objects, or assets. In this tutorial we have created assets that mimics the graph in the paper. You do not necessarily need to do that, you can create a more general DSL, e.g coreLang, that will have more use cases. This DSL is very specific for the paper.</p> <p>Click and drag the assets unto the canvas and connect them by holding shift and click-drag the connections between the assets. We organize the model in the same way as we organized the DSL.</p> <p><img src="/pages/guides/Creating%20threat%20models/Images/securicad1.png" alt="title" /></p> <p>We attach an attacker asset to IronpieM6. When we attach the attacker we get to chose where the attacker has gained foothold. We chose GuessPassword, since that function points to our PasswordSuccess function that simulates a dictionary bruce force attack.</p> <p><img src="/pages/guides/Creating%20threat%20models/Images/securicad2.png" alt="title" /></p> <p>The model is now ready for its first simulation. Press the simulate button in the top left corner.</p> <p>The results will show up on the right column. If we press on the asset we will see all the functions and if they are at risk. The darker color, the more risk. The reason why GuessPassword is dark is because the attacker gains 100% foothold on its first function.</p> <p><img src="/pages/guides/Creating%20threat%20models/Images/securicad3.png" alt="title" /></p> <p>We have marked ssh in the image. In the lower right column you find Time to Compromise (TTC). This is a probability graph how likely it is for the attack to succeed. Since we used the probability distribution “HardAndUncertain” the probability of an attacker breaking the password will never be higher than 50%, no matter how long the attack persist.</p> <p>We have created connections between the IronpieM6 and the router. If we click on the router we can see that it risks to be compromised as well. Click on HTTPSconnect to see the risk for success rate that an attacker will connect through HTTPS to the router through the IronpieM6.</p> <p><img src="/pages/guides/Creating%20threat%20models/Images/securicad5.png" alt="title" /></p> <p>You can produce an attack graph by pressing “Visualize Critical Path” in the “Attacks” window to the right. This generates a visual representation of the path that an attacker could take to compromise the asset.</p> <p><img src="/pages/guides/Creating%20threat%20models/Images/attackpath1.png" alt="title" /></p> <p>This representation will grow in size depending how large and detailed your model is.</p> <p>In this tutorial we have created a DSL with using MAL and compiling it into a .jar-file using foreseetis Maven repository. Then we built the model in securiCAD and ran an dictionary brute force attack simulation.</p> <h2 id="more-examples"> <a href="#more-examples" class="anchor-heading" aria-labelledby="more-examples"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> More examples </h2> <p>We have created a simple DSL and a model to simulate attacks. Here we will extend the model.</p> <p>Lets imagine that our robot vacuum cleaner has protection implemented against bruteforce attacks. We can add that type of defense with the # symbol.</p> <h2 id="defense"> <a href="#defense" class="anchor-heading" aria-labelledby="defense"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Defense </h2> <p>There are two syntax rules to follow for defenses. First we need to become familiar with AND. In the step-guide we did not use AND, only OR.</p> <p>&amp; (or AND) means that multiple steps need to be fullfilled in order to advance. Example</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&amp; step1
  -&gt; step3
&amp; step2
  -&gt; step3
| step3
</code></pre></div></div> <p>In order to reach step3 in the above example both step1 and step2 needs to be fullfilled.</p> <p>To use defense we write</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&amp; step1
  -&gt; step2
# defense
  -&gt; step2
</code></pre></div></div> <div class="table-wrapper"><table> <tbody> <tr> <td>Here we also use a &amp; (AND) because we need to include the defense step. If we would use</td> <td>(OR) then the program would just skip the defense and go straight to step2.</td> </tr> </tbody> </table></div> <p>If the defense is active, then the attacker cannot reach step2 even if the attacker would could reach step1. You can set a defense to either on, off or to a probability that it is active.</p> <p>If it is off, then the attacker can reach step2. If you set it to a probability, then it will increase the time to compromise for the asset that you are interested in.</p> <p>We change the syntax for our robot vacuum cleaner to</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  asset IronpieM6 {
      
      | HTTPSconnect

      | HTTPSaccess
        -&gt; router.HTTPSconnect

      | TCPconnect

      | TCPaccess
        -&gt; router.TCPconnect
      
      | UDPaccess
        -&gt; router.UDPconnect

      | ssh
        -&gt; HTTPSaccess,
        TCPaccess,
        UDPaccess

      | guessPassword
        -&gt; passwordSuccess
      
      &amp; passwordSuccess [HardAndUncertain]
        -&gt; ssh

      # antiBruteforce
        -&gt; passwordSuccess
    }
}
</code></pre></div></div> <p>If you have followed the steps so far, save the model using “Save as” anywhere except under the target-folder in your project directory. That folder will be deleted if you run the command “mvn clean”.</p> <p>Recompile the code, create a new .jar file and restart securiCAD.</p> <p>When you click on the ironpieM6 you will see to the right that there exists a defense tab as well. Click on the tab adjust the defense.</p> <p><img src="/pages/guides/Creating%20threat%20models/Images/securiDefense1.png" alt="title" /></p> <p>In the first example we will turn on the defense and run the simulation. You can see on the graph for the time to compromise that the attacker could not attack the router.</p> <p><img src="/pages/guides/Creating%20threat%20models/Images/securiDefense2.png" alt="title" /></p> <p>Since no attack was possible we cannot generate any visualization, but we go back to the defense tab for ironpieM6 and change the defense from “On” to “Probability”, with a probability of 0.5.</p> <p><img src="/pages/guides/Creating%20threat%20models/Images/securiDefense3.png" alt="title" /></p> <p>If we simulate an attack this time the time to compromise will decrease from step-to-step guide but there is still a chance for the attacker to reach its target.</p> <p><img src="/pages/guides/Creating%20threat%20models/Images/securiDefense4.png" alt="title" /></p> <p>And the visualization of the attack now looks like, where the defense step is included</p> <p><img src="/pages/guides/Creating%20threat%20models/Images/securiDefense5.png" alt="title" /></p> <h2 id="and"> <a href="#and" class="anchor-heading" aria-labelledby="and"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> AND </h2> <p>Lets look a little bit closer on the &amp; (AND) syntax. As stated before it means that two or more steps needs to be fulfilled in order to advance.</p> <p>Lets imagine that the application, TrifoHome, has 2FA (two factor authentication) activated. We both need a password and a security code generated by either another application, sms, e-mail etc.</p> <p>We add the following lines to the TrifoHome asset</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  asset TrifoHome {
      
      | password
        -&gt; access

      | authentication
        -&gt; access      

      &amp; access
        -&gt; HTTPSaccess,
        TCPaccess

      | HTTPSconnect

      | HTTPSaccess
        -&gt; router.HTTPSconnect

      | TCPconnect
      
      | TCPaccess
        -&gt; router.TCPconnect
    }
</code></pre></div></div> <h2 id="existence"> <a href="#existence" class="anchor-heading" aria-labelledby="existence"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Existence </h2> <p>Existence does exactly what it sounds like, it checks if something exists and if it does, it advances to the next step. The syntax for Existance is E. Example</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>E exisOrNot
  &lt;- checkExistence
  -&gt; step
</code></pre></div></div> <p>Since you should not do anything illegal lets assume that you visit your friends house and they have a robot vacuum cleaner. You borrow your friends phone and try to guess the password. If you write the correct password you will be prompted to fill in the authentication code, so your friend must be in the house to be able to give it to you.</p> <p>We have already added the necessary AND condition in the previous topic. Now we have to add a condition if our friend is there and an attack step.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  asset TrifoHome {
      | attack
        -&gt; passwordAttack,
        tokenExists
      
      | passwordAttack [HardAndUncertain]
        -&gt; password

      E tokenExists
        &lt;- human
        -&gt; human.tokenGenerate
      
      | password
        -&gt; access

      | authentication
        -&gt; access      

      &amp; access
        -&gt; HTTPSaccess,
        TCPaccess

      | HTTPSconnect

      | HTTPSaccess
        -&gt; router.HTTPSconnect

      | TCPconnect
      
      | TCPaccess
        -&gt; router.TCPconnect
    }
</code></pre></div></div> <p>In our human asset we need to add a step called tokenGenerate, since it is the step that we are calling for in the TrifoHome asset.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  asset Human {
    
      | tokenGenerate 
        -&gt; trifo.authentication
    }
</code></pre></div></div> <p>The step just points to the authentication, since our friend gives us the code when asked.</p> <p>To simulate this we need to set an attacker on the TrifoHome asset in securiCAD instead of IronpieM6 that we have used earlier. When connecting the attacker you must chose the “Attack” function as demonstrated in the step-by-step guide.</p> <p><img src="/pages/guides/Creating%20threat%20models/Images/securiExistence1.png" alt="title" /></p> <p>Just as before, what we are really interested in is access to the router, not the app itself. The visualization would look like</p> <p><img src="/pages/guides/Creating%20threat%20models/Images/securiExistence2.png" alt="title" /></p> <p>Just as there exists an Exist-function, there also exists a not Exists-function. It works the same with the difference that it only goes to the second step if the checked asset does not exist.</p> <hr> <footer> <p class="text-small text-grey-dk-100 mb-0">Division of Network and Systems Engineering | KTH</p> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
